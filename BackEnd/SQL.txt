-- 1) 스키마 생성
CREATE DATABASE IF NOT EXISTS drawit
  DEFAULT CHARACTER SET utf8mb4
  DEFAULT COLLATE utf8mb4_0900_ai_ci;

-- 2) 계정 생성
CREATE USER IF NOT EXISTS 'drawit'@'%'
    IDENTIFIED BY 'drawit';

-- 3) 권한 부여 (drawit 스키마에 대한 모든 권한)
GRANT ALL PRIVILEGES ON drawit.* TO 'drawit'@'%';

-- 4) 권한 적용
FLUSH PRIVILEGES;

-- 5) 유저 테이블 생성
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    room_id VARCHAR(50) NOT NULL,
    nickname VARCHAR(50) NOT NULL,
    is_host BOOLEAN NOT NULL DEFAULT FALSE,
    session_id VARCHAR(100) NOT NULL,

    CONSTRAINT fk_users_lobby
        FOREIGN KEY (room_id)
        REFERENCES lobby(id)
        ON DELETE CASCADE,

    CONSTRAINT uq_room_nickname
        UNIQUE (room_id, nickname)
);

